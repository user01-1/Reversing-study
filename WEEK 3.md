# WEEK 3
- [x]  드림핵
  - 기드라 과정: 디버거 이슈 해결
- [x]  도서 ‘리버싱 핵심원리’ - 2부
- [x]  문제풀이 과제
  - reversing\.kr - Easy Unpack
  - dreamhack- SimpleCrackMe, Small Counter
  - 나머지는 개인적으로 진행

<br>

## 리버싱 핵심원리
### 실행 압축
실행 압축
- PE 파일을 대상으로 파일 내부에 압축해제 코드를 포함
- 코드 실행 순간 메모리에서 압축해제 후 실행

패커: PE 파일 전문 압축기
- 평범한 PE파일을 만드는 UPX, ASPack 등
- 불순한 의도를 가진 UPACK, PESpin, NSAnti 등

PE 프로텍터
- PE파일을 리버싱으로부터 보호하는 유틸리티. 실행압축 + 안티디버깅 + 안티에뮬레이팅 + 코드난독화 ....
- 크래킹 방지, 코드 및 리소스 보호 목적
- 게임 보안 프로그램 등에 적용(해킹툴 실행방지)

### UPX 실습
upx 툴을 이용하여 notepad.exe 실행압축 > PEView.exe로 확인
![WEEK3_upx1](./img/WEEK3/WEEK3_upx1.png)

첫 번째 섹션 헤더 UPX0의 `SizeofRawData(파일에서 섹션이 차지하는 크기)`가 0이다. 이유는 UPX로 실행압축된 파일은 실행시 압축된 코드를 첫번째 섹션에 풀기 때문.  
**→ 압축해제 코드, 압축된 원본 코드는 두번째 섹션에 위치함**  
**→ 파일 실행 > 압축해제코드 실행 > 압축된 원본을 첫번째 섹션에 압축해제시킴 > 원본 EP코드 실행**

즉 패커나 프로텍터를 사용한 프로그램은 EP가 숨겨져있고, 패킹된 코드가 실행된다.(패커의 EP부터 실행)

--- 책 따라서 실습할 사람들은, 올리디버거 옵션 수정 필요함(자동 언패킹 옵션 체크되어 있음) ---

![자동어패킹](./img/WEEK3/ollydbg옵션(언패킹).png)


<br>

### UPX의 OEP 찾는 방법
**1. UPX 패커의 특징 이용**
- EP코드가 PUSHAD/POPAD 명령어로 둘러쌓여 있는 특징을 이용.
- OPE 코드로 가는 JMP 명령어가 POPAD 명령어 바로 이후에 나타남
- 이러한 JMP 명령어에 BP 후 실행


**2. 스택에 하드웨어 BP 설치**
- UPX 특징인 PUSHAD/POPAD 명령어 특성 이용
- PUSHAD 명령 실행 후 Dump 윈도우에서 ESP가 가리키는 주소로 이동
- 하드웨어 BP 설정 후 실행
  - 하드웨어 BP 설치된 명령어가 실행된 이후에 제어가 멈춤
  - POPAD가 호출되는 순간에 하드웨어 BP 설치된 주소 액세스 후 제어가 멈춤.
  - 바로 밑에 OEP 가는 JMP 명령어 존재

